<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bodunde CMS ‚Äî Admin</title>
<meta name="description" content="Private admin panel for Bodunde site." />

<style>
  :root{
    --bg:#0B0D12;         /* app background (dark) */
    --panel:#121520;      /* cards/panels */
    --panel-2:#0F1320;    /* sidebar */
    --soft:#1A2030;       /* table rows / inputs */
    --line:#22283A;       /* borders */
    --text:#E9EEF9;       /* primary text */
    --muted:#9AA6BF;      /* secondary text */
    --accent:#FF4D00;     /* brand orange */
    --accent-2:#FF8C00;
    --green:#22C55E;
    --red:#EF4444;
    --r:14px;
    --shadow:0 14px 40px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:var(--bg);color:var(--text);
    font-family:ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    -webkit-font-smoothing:antialiased; line-height:1.5;
  }
  a{color:inherit;text-decoration:none}

  /* ===== Layout */
  .app{display:grid; grid-template-columns:260px 1fr; min-height:100%}
  .side{
    background:var(--panel-2); border-right:1px solid var(--line);
    padding:18px; position:sticky; top:0; height:100dvh;
  }
  .brand{display:flex; align-items:center; gap:10px; margin-bottom:16px}
  .brand .logo svg{width:28px;height:28px;fill:#fff}
  .brand .name{font-weight:900; letter-spacing:.3px}
  .side .mutey{color:var(--muted); font-size:12px; text-transform:uppercase; letter-spacing:.12em; margin:12px 0 8px}
  .nav{display:flex; flex-direction:column; gap:6px}
  .nav a{
    padding:10px 12px; border-radius:10px; color:#D6DDF0; display:flex; align-items:center; gap:10px;
  }
  .nav a.active{background:linear-gradient(120deg,var(--accent),var(--accent-2)); color:#fff; font-weight:800}
  .nav a svg{width:16px;height:16px;fill:currentColor;opacity:.9}

  .main{padding:22px; display:grid; gap:18px}
  .topbar{display:flex; align-items:center; justify-content:space-between}
  .btn, .ghost{
    border:0; border-radius:10px; padding:10px 14px; cursor:pointer; font-weight:800;
  }
  .btn{background:linear-gradient(120deg,var(--accent),var(--accent-2)); color:#fff; box-shadow:0 10px 28px rgba(255,77,0,.25)}
  .ghost{background:transparent; color:#fff; border:1px solid var(--line)}
  .ok{color:var(--green); font-weight:800; display:none}
  .err{color:var(--red); font-weight:800; display:none}

  .card{
    background:var(--panel); border:1px solid var(--line); border-radius:var(--r); box-shadow:var(--shadow);
  }
  .pad{padding:18px}

  /* table */
  table{width:100%; border-collapse:collapse; font-size:14px}
  thead th{color:#BFD0F5; text-align:left; padding:12px; background:#12192B; border-bottom:1px solid var(--line)}
  tbody td{padding:12px; border-bottom:1px solid var(--line); color:#E6EDFF}
  tbody tr:hover{background:var(--soft)}
  .tag{display:inline-block; padding:6px 10px; border-radius:999px; background:#1E2436; color:#CBD6F0; font-weight:700; font-size:12px}

  .tools{display:flex; gap:8px}
  .tiny{font-size:12px; padding:8px 10px}

  /* editor */
  .grid2{display:grid; grid-template-columns:1fr 1fr; gap:12px}
  @media(max-width:900px){ .app{grid-template-columns:1fr} .side{position:relative; height:auto} .grid2{grid-template-columns:1fr} }
  label{font-size:12px; color:var(--muted); font-weight:800; text-transform:uppercase; letter-spacing:.08em}
  .field, .select{
    width:100%; padding:12px 14px; border-radius:10px; background:var(--soft); border:1px solid var(--line);
    color:#DDE7FF; outline:none;
  }
  textarea.field{min-height:120px; resize:vertical}
  .row{display:grid; gap:6px}
  .bar{display:flex; gap:10px; align-items:center; flex-wrap:wrap}

  .sections{display:flex; flex-direction:column; gap:12px}
  .section{
    border:1px dashed var(--line); background:#0F1422; border-radius:12px; padding:12px;
  }
  .s-head{display:flex; align-items:center; justify-content:space-between; margin-bottom:8px}
  .s-title{font-weight:900}
  .s-tools{display:flex; gap:6px}
  .iconbtn{border:1px solid var(--line); background:transparent; color:#DDE7FF; border-radius:8px; padding:6px 8px; cursor:pointer}

  /* gate */
  .gate{
    position:fixed; inset:0; background:rgba(0,0,0,.88); display:flex; align-items:center; justify-content:center; z-index:1000;
  }
  .login{width:min(440px,94vw); background:#101420; border:1px solid var(--line); border-radius:16px; overflow:hidden; box-shadow:var(--shadow)}
  .login-head{background:linear-gradient(120deg,var(--accent),var(--accent-2)); padding:16px; font-weight:900; text-align:center}
  .login-body{padding:16px}
</style>
</head>
<body>

<div class="app">

  <!-- ===== Sidebar -->
  <aside class="side">
    <div class="brand">
      <div class="logo">
        <svg viewBox="0 0 24 24"><path d="M22 12a10 10 0 1 0-11.5 9.9v-7h-2v-2.9h2v-2.2c0-2 1.2-3.1 3-3.1.9 0 1.8.1 2 .1v2.3h-1.1c-1 0-1.3.6-1.3 1.2v1.7h2.6l-.4 2.9h-2.2v7A10 10 0 0 0 22 12z" fill="currentColor"/></svg>
      </div>
      <div class="name">Bodunde CMS</div>
    </div>

    <div class="mutey">Manage</div>
    <nav class="nav" id="nav">
      <a href="#" data-panel="portfolio" class="active">
        <svg viewBox="0 0 24 24"><path d="M4 6h16v12H4zM9 6V4h6v2"/></svg> Portfolio
      </a>
      <a href="#" data-panel="home"><svg viewBox="0 0 24 24"><path d="M3 11l9-8 9 8v9H3z"/></svg> Home</a>
      <a href="#" data-panel="about"><svg viewBox="0 0 24 24"><path d="M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10Zm-8 9c0-3.3 3.6-6 8-6s8 2.7 8 6"/></svg> About</a>
      <a href="#" data-panel="blog"><svg viewBox="0 0 24 24"><path d="M4 5h16v14H4zM7 8h10M7 12h10M7 16h6"/></svg> Blog</a>
      <a href="#" data-panel="contact"><svg viewBox="0 0 24 24"><path d="M4 6h16v12H4zM7 9h10M7 13h7"/></svg> Contact</a>
      <a href="#" data-panel="four"><svg viewBox="0 0 24 24"><path d="M4 4h16v16H4zM9 9l6 6M15 9l-6 6"/></svg> 404</a>
    </nav>
  </aside>

  <!-- ===== Main -->
  <main class="main">
    <div class="topbar">
      <div style="font-weight:900">Portfolio Manager</div>
      <div class="bar">
        <button id="exportBtn" class="ghost tiny">Export JSON</button>
        <label for="importFile" class="ghost tiny" style="cursor:pointer">Import JSON</label>
        <input id="importFile" type="file" accept="application/json" style="display:none">
        <button id="logout" class="ghost tiny">Log out</button>
      </div>
    </div>

    <!-- ===== Portfolio LIST -->
    <section class="card" id="panel_portfolio">
      <div class="pad">
        <div class="bar" style="justify-content:space-between; margin-bottom:10px">
          <div>
            <div style="font-size:18px; font-weight:900">Projects</div>
            <div style="color:var(--muted); font-size:13px">Add, edit, delete. Sorted by last update (newest first).</div>
          </div>
          <button class="btn tiny" id="addBtn">‚ûï Add Project</button>
        </div>

        <!-- Keep this table wrapper (class "preview" is for border styling here only) -->
        <div class="preview" style="border-radius:12px">
          <table id="projTable">
            <thead>
              <tr>
                <th style="width:34px">#</th>
                <th>Title</th>
                <th style="width:140px">Tag</th>
                <th style="width:120px">Date</th>
                <th style="width:160px">Updated</th>
                <th style="width:180px">Actions</th>
              </tr>
            </thead>
            <tbody id="projBody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- ===== Editor (Add/Edit) -->
    <section class="card" id="panel_editor" style="display:none">
      <div class="pad">
        <div class="bar" style="justify-content:space-between; margin-bottom:6px">
          <div style="font-size:18px; font-weight:900" id="editorTitle">New Project</div>
          <div class="bar">
            <button class="ghost tiny" id="backBtn">‚üµ Back to list</button>
            <button class="ghost tiny" id="deleteBtn" style="display:none;color:var(--red);border-color:#432">Delete</button>
            <button class="btn tiny" id="saveBtn">Save</button>
          </div>
        </div>

        <div class="grid2">
          <div class="row">
            <label>Project Title</label>
            <input id="f_title" class="field" placeholder="Monitor app design">
          </div>
          <div class="row">
            <label>Tag</label>
            <input id="f_tag" class="field" placeholder="Product design">
          </div>
        </div>

        <div class="grid2" style="margin-top:10px">
          <div class="row">
            <label>Date</label>
            <input id="f_date" class="field" placeholder="July 2014">
          </div>
          <div class="row">
            <label>Hero Image (URL or upload)</label>
            <div class="bar" style="gap:8px">
              <input id="f_hero" class="field" placeholder="https://‚Ä¶">
              <input id="f_hero_file" type="file" accept="image/*" class="ghost tiny" style="padding:9px 10px">
            </div>
          </div>
        </div>

        <div class="row" style="margin-top:10px">
          <label>Short Description</label>
          <textarea id="f_desc" class="field" placeholder="A short summary shown at the top‚Ä¶"></textarea>
        </div>

        <div class="bar" style="margin-top:14px">
          <div style="font-weight:900">Sections</div>
          <select id="addType" class="select" style="max-width:220px">
            <option value="h2">Header</option>
            <option value="p">Paragraph</option>
            <option value="img">Image</option>
          </select>
          <button class="ghost tiny" id="addSectionBtn">Add Section</button>
        </div>

        <div class="sections" id="sections" style="margin-top:10px"></div>

        <div class="bar" style="margin-top:16px">
          <span class="ok" id="saveOk">Saved ‚úì</span>
          <span class="err" id="saveErr">Save failed</span>
        </div>
      </div>
    </section>

    <!-- Placeholder panels (coming soon) -->
    <section class="card" id="panel_home" style="display:none"><div class="pad">Home settings ‚Äî coming soon.</div></section>
    <section class="card" id="panel_about" style="display:none"><div class="pad">About settings ‚Äî coming soon.</div></section>
    <section class="card" id="panel_blog" style="display:none"><div class="pad">Blog settings ‚Äî coming soon.</div></section>
    <section class="card" id="panel_contact" style="display:none"><div class="pad">Contact settings ‚Äî coming soon.</div></section>
    <section class="card" id="panel_four" style="display:none"><div class="pad">404 settings ‚Äî coming soon.</div></section>

  </main>
</div>

<!-- ===== Password Gate -->
<div class="gate" id="gate">
  <div class="login">
    <div class="login-head">Bodunde Admin Login</div>
    <div class="login-body">
      <div class="row">
        <label>Password</label>
        <input id="pass" type="password" class="field" placeholder="Enter password">
      </div>
      <div class="bar" style="margin-top:10px">
        <button class="btn" id="enter">Enter</button>
        <span style="color:var(--muted); font-size:12px">Change it inside the code: <code>PASSWORD</code></span>
      </div>
    </div>
  </div>
</div>

<script>
/* =========================
   Tiny Store (localStorage)
   ========================= */
const LS_KEY = 'cms_projects';

const Store = {
  all(){
    try{
      const arr = JSON.parse(localStorage.getItem(LS_KEY) || '[]');
      // sort by updated desc
      arr.sort((a,b)=> (b.updated||0)-(a.updated||0));
      return arr;
    }catch(e){ return [] }
  },
  saveAll(list){
    localStorage.setItem(LS_KEY, JSON.stringify(list));
  },
  upsert(project){
    const list = Store.all();
    if(!project.id){ project.id = crypto.randomUUID ? crypto.randomUUID() : String(Date.now()); }
    project.updated = Date.now();
    const idx = list.findIndex(x=>x.id===project.id);
    if(idx>=0){ list[idx]=project; } else { list.unshift(project); }
    Store.saveAll(list);
    return project.id;
  },
  remove(id){
    const list = Store.all().filter(x=>x.id!==id);
    Store.saveAll(list);
  },
  byId(id){ return Store.all().find(x=>x.id===id); }
};

/* =========================
   UI Helpers
   ========================= */
const $ = sel => document.querySelector(sel);
const $$ = sel => document.querySelectorAll(sel);
function show(id){ $(id).style.display='block'; }
function hide(id){ $(id).style.display='none'; }
function flash(okSel, errSel, good){
  const ok = $(okSel), er = $(errSel);
  if(good){ ok.style.display='inline'; er.style.display='none'; setTimeout(()=>ok.style.display='none',1300); }
  else { er.style.display='inline'; ok.style.display='none'; setTimeout(()=>er.style.display='none',1300); }
}

/* =========================
   Password Gate
   ========================= */
const PASSWORD = 'bodunde123'; // ‚Üê change this
const gate = $('#gate'), pass = $('#pass'), enter = $('#enter'), logoutBtn = $('#logout');
function openApp(){ gate.style.display='none'; sessionStorage.setItem('bod_authed','yes'); }
function openGate(){ gate.style.display='flex'; sessionStorage.removeItem('bod_authed'); }
if(sessionStorage.getItem('bod_authed')==='yes') openApp();
enter.addEventListener('click',()=>{ if(pass.value.trim()===PASSWORD) openApp(); else alert('Wrong password'); });
pass.addEventListener('keydown',e=>{ if(e.key==='Enter') enter.click(); });
logoutBtn.addEventListener('click',openGate);

/* =========================
   Panels (sidebar)
   ========================= */
const nav = $('#nav');
nav.addEventListener('click', (e)=>{
  if(e.target.closest('a')){
    e.preventDefault();
    const a = e.target.closest('a');
    $$('.nav a').forEach(x=>x.classList.remove('active'));
    a.classList.add('active');

    $$('[id^="panel_"]').forEach(p=>p.style.display='none');
    const key = a.dataset.panel;
    const panel = $('#panel_'+key);
    if(panel) panel.style.display = 'block';
  }
});

/* =========================
   Portfolio List
   ========================= */
const projBody = $('#projBody');
function renderTable(){
  const list = Store.all();
  projBody.innerHTML = '';
  if(!list.length){
    projBody.innerHTML = '<tr><td colspan="6" style="color:#9fb">No projects yet. Click ‚ÄúAdd Project‚Äù.</td></tr>';
    return;
  }
  list.forEach((p,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${i+1}</td>
      <td>${escapeHtml(p.title||'‚Äî')}</td>
      <td><span class="tag">${escapeHtml(p.tag||'‚Äî')}</span></td>
      <td>${escapeHtml(p.date||'‚Äî')}</td>
      <td>${fmtTime(p.updated)}</td>
      <td class="tools">
        <button class="ghost tiny" data-edit="${p.id}">‚úèÔ∏è Edit</button>
        <button class="ghost tiny" data-del="${p.id}" style="color:var(--red); border-color:#432">üóëÔ∏è Delete</button>
      </td>
    `;
    projBody.appendChild(tr);
  });
}
function escapeHtml(s){ return (s||'').replace(/[&<>"]/g,c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[c])); }
function fmtTime(t){ if(!t) return '‚Äî'; const d = new Date(t); return d.toLocaleString(); }

renderTable();

projBody.addEventListener('click',(e)=>{
  const editId = e.target.getAttribute('data-edit');
  const delId  = e.target.getAttribute('data-del');
  if(editId){ openEditor(Store.byId(editId)); }
  if(delId){
    if(confirm('Delete this project?')){
      Store.remove(delId);
      renderTable();
    }
  }
});

$('#addBtn').addEventListener('click', ()=> openEditor(null));

/* =========================
   Editor
   ========================= */
const editorTitle = $('#editorTitle');
const f_title = $('#f_title'), f_tag=$('#f_tag'), f_date=$('#f_date'), f_desc=$('#f_desc');
const f_hero = $('#f_hero'), f_hero_file=$('#f_hero_file');
const sectionsHost = $('#sections');
const saveBtn = $('#saveBtn'), backBtn=$('#backBtn'), deleteBtn=$('#deleteBtn');
const addType = $('#addType'), addSectionBtn = $('#addSectionBtn');

let currentId = null;
function openEditor(project){
  currentId = project ? project.id : null;

  $('#panel_portfolio').style.display = 'none';
  $('#panel_editor').style.display = 'block';
  editorTitle.textContent = project ? 'Edit Project' : 'New Project';
  deleteBtn.style.display = project ? 'inline-block' : 'none';

  f_title.value = project?.title || '';
  f_tag.value   = project?.tag   || '';
  f_date.value  = project?.date  || '';
  f_desc.value  = project?.desc  || '';
  f_hero.value  = project?.hero  || '';
  f_hero_file.value = '';
  sectionsHost.innerHTML = '';

  (project?.sections || []).forEach((s, idx)=> {
    addSectionUI(s.type, s.value, s.alt, idx);
  });

  if(!project){ currentId = null; }
}

backBtn.addEventListener('click', ()=>{
  $('#panel_editor').style.display='none';
  $('#panel_portfolio').style.display='block';
  renderTable();
});
deleteBtn.addEventListener('click', ()=>{
  if(currentId && confirm('Delete this project?')){
    Store.remove(currentId);
    backBtn.click();
  }
});

addSectionBtn.addEventListener('click', ()=>{
  addSectionUI(addType.value, '', '');
});

/* ===== No image preview version ===== */
function addSectionUI(type, value='', alt='', forceIndex=null){
  const block = document.createElement('div');
  block.className = 'section';
  const idx = forceIndex ?? sectionsHost.children.length;

  block.innerHTML = `
    <div class="s-head">
      <div class="s-title">${type.toUpperCase()}</div>
      <div class="s-tools">
        <button class="iconbtn" data-up>‚¨Ü</button>
        <button class="iconbtn" data-down>‚¨á</button>
        <button class="iconbtn" data-remove style="color:var(--red)">‚úñ</button>
      </div>
    </div>
    <div class="row">
      ${type==='h2' ? `
        <label>Heading Text</label>
        <input class="field s-val" placeholder="Section title" value="${escapeAttr(value)}">
      ` : type==='p' ? `
        <label>Paragraph</label>
        <textarea class="field s-val" placeholder="Write the content‚Ä¶">${escapeHtml(value)}</textarea>
      ` : `
        <label>Image (URL or upload)</label>
        <div class="bar">
          <input class="field s-val" placeholder="https://‚Ä¶" value="${escapeAttr(value)}">
          <input type="file" accept="image/*" class="ghost tiny s-file" style="padding:9px 10px">
        </div>
        <div class="row" style="margin-top:6px">
          <label>Alt text</label>
          <input class="field s-alt" placeholder="Describe the image" value="${escapeAttr(alt)}">
        </div>
      `}
    </div>
  `;

  const btnUp = block.querySelector('[data-up]');
  const btnDown = block.querySelector('[data-down]');
  const btnRemove = block.querySelector('[data-remove]');
  btnUp.addEventListener('click', ()=> moveSection(block, -1));
  btnDown.addEventListener('click', ()=> moveSection(block, +1));
  btnRemove.addEventListener('click', ()=> block.remove());

  // File ‚Üí dataURL (no preview shown)
  const file = block.querySelector('.s-file');
  if(file){
    file.addEventListener('change', e=>{
      const f = e.target.files?.[0];
      if(!f) return;
      const reader = new FileReader();
      reader.onload = () => {
        block.querySelector('.s-val').value = reader.result; // keep storing DataURL/URL
      };
      reader.readAsDataURL(f);
    });
  }

  sectionsHost.appendChild(block);
}

function moveSection(block, dir){
  const parent = sectionsHost;
  const i = Array.from(parent.children).indexOf(block);
  const j = i + dir;
  if(j<0 || j>=parent.children.length) return;
  parent.insertBefore(block, parent.children[dir>0 ? j+1 : j]);
}

function escapeAttr(s){ return (s||'').replace(/"/g,'&quot;'); }

/* Save */
saveBtn.addEventListener('click', ()=>{
  const project = {
    id: currentId,
    title: f_title.value.trim(),
    tag:   f_tag.value.trim(),
    date:  f_date.value.trim(),
    desc:  f_desc.value.trim(),
    hero:  f_hero.value.trim(),
    sections: []
  };
  sectionsHost.querySelectorAll('.section').forEach(sec=>{
    const kind = sec.querySelector('.s-title').textContent.toLowerCase();
    const valEl = sec.querySelector('.s-val');
    const altEl = sec.querySelector('.s-alt');
    project.sections.push({
      type: kind==='header' ? 'h2' : (kind.includes('paragraph') ? 'p' : (kind.includes('img') ? 'img' : (['h2','p','img'].includes(kind)?kind:'p'))),
      value: (valEl?.value || '').trim(),
      alt: (altEl?.value || '').trim()
    });
  });

  // hero upload to dataURL if file selected (no hero preview)
  const hf = f_hero_file.files?.[0];
  if(hf){
    const reader = new FileReader();
    reader.onload = ()=>{ project.hero = reader.result; persist(project); };
    reader.readAsDataURL(hf);
  }else{
    persist(project);
  }
});

function persist(project){
  if(!project.title){ alert('Title is required'); return; }
  Store.upsert(project);
  flash('#saveOk','#saveErr',true);
  setTimeout(()=> backBtn.click(), 400);
}

/* =========================
   Import / Export
   ========================= */
$('#exportBtn').addEventListener('click', ()=>{
  const data = JSON.stringify(Store.all(), null, 2);
  const blob = new Blob([data], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'bodunde-projects.json';
  document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
});
$('#importFile').addEventListener('change', (e)=>{
  const f = e.target.files?.[0];
  if(!f) return;
  const reader = new FileReader();
  reader.onload = ()=>{
    try{
      const arr = JSON.parse(reader.result);
      if(Array.isArray(arr)){ Store.saveAll(arr); renderTable(); alert('Imported successfully'); }
      else alert('Invalid JSON');
    }catch(err){ alert('Import failed'); }
  };
  reader.readAsText(f);
});
</script>
</body>
</html>
